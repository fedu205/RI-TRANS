1;26.04.2022 18:52:13.024;70;"<?query --SELECT num_vagon, users_group_id, MAX(date_operation) max_date_operation     INTO #x1    FROM  fact_track_vagon WITH(NOLOCK)     WHERE date_operation IS NOT NULL 		/*AND date_query < @date_last*/						--12.12.2018 было берем за все время		AND date_query BETWEEN @date_first AND @date_last	--12.12.2018 обрезаем выборку вагонов полугодом а не за все время		AND users_group_id IN (502778,1626295,4633962)    GROUP BY num_vagon, users_group_id     ORDER BY 2     --?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;Lis1;                  2;
2;26.04.2022 18:52:13.086;LoadFactTrackStat;Running;26.04.2022 18:50:00;132;
1;26.04.2022 18:52:52.460;70;"<?query --CREATE INDEX #stay ON #stay(users_group_id, fact_track_trip_id, num_vagon, node_operation_cod, date_query)--print '10'--**************************************************************************************************************************************************			--Простой в рейсе			--?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;tempdb;                  2;
2;26.04.2022 18:52:52.469;LoadFactTrackStat;Running;26.04.2022 18:50:00;171;
1;26.04.2022 19:00:15.881;89;"<?query --INSERT #tmp_num_vagon 		SELECT num_vagon, vagon_comment		FROM view_vagon_owner vo WITH (NOLOCK) 			JOIN vagon_comment c WITH (NOLOCK) ON  (c.vagon_id = vo.vagon_id) 				AND (c.vagon_comment_type_id = 908732 ) 				AND ( @date_begin BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , @date_begin+1)) 				AND (vagon_comment IN (SELECT comment collate Cyrillic_General_CI_AS FROM #tmp_comment WITH (NOLOCK))) -- отбор по комментарию №6		WHERE (users_group_id = @users_group_id) AND (@date_begin BETWEEN vo.date_begin AND ISNULL(vo.date_end, @date_begin+1)) -- действующие --?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;Lis1;                  2;
1;26.04.2022 19:00:15.881;90;"<?query --BACKUP DATABASE [Lis_Etran] TO  DISK = N'\\10.10.101.33\backup-lis\Lis_Etran\Lis_Etran_backup_2022_04_26_190001_3623136.bak' WITH  DIFFERENTIAL , NOFORMAT, NOINIT,  NAME = N'Lis_Etran_backup_2022_04_26_190001_3623136', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10--?>";sa;(35ms)ASYNC_IO_COMPLETION;ULSRV-LIS;Lis_Etran;                  0;
2;26.04.2022 19:00:15.891;all_base_bkp.incremental;Running;26.04.2022 19:00:00;15;
2;26.04.2022 19:00:15.891;sp_fact_track_mailing;Running;26.04.2022 19:00:00;15;
1;26.04.2022 19:00:41.251;89;"<?query --INSERT #tmp_num_vagon 		SELECT num_vagon, vagon_comment		FROM view_vagon_owner vo WITH (NOLOCK) 			JOIN vagon_comment c WITH (NOLOCK) ON  (c.vagon_id = vo.vagon_id) 				AND (c.vagon_comment_type_id = 908732 ) 				AND ( @date_begin BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , @date_begin+1)) 				AND (vagon_comment IN (SELECT comment collate Cyrillic_General_CI_AS FROM #tmp_comment WITH (NOLOCK))) -- отбор по комментарию №6		WHERE (users_group_id = @users_group_id) AND (@date_begin BETWEEN vo.date_begin AND ISNULL(vo.date_end, @date_begin+1)) -- действующие --?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;Lis1;                  2;
1;26.04.2022 19:00:41.251;90;"<?query --BACKUP DATABASE [Lis_Fact] TO  DISK = N'\\10.10.101.33\backup-lis\Lis_Fact\Lis_Fact_backup_2022_04_26_190001_3779401.bak' WITH  DIFFERENTIAL , NOFORMAT, NOINIT,  NAME = N'Lis_Fact_backup_2022_04_26_190001_3779401', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10--?>";sa;(658ms)ASYNC_IO_COMPLETION;ULSRV-LIS;Lis_Fact;                  0;
2;26.04.2022 19:00:41.269;all_base_bkp.incremental;Running;26.04.2022 19:00:00;40;
2;26.04.2022 19:00:41.269;sp_fact_track_mailing;Running;26.04.2022 19:00:00;40;
1;26.04.2022 19:01:29.014;89;"<?query --INSERT #tmp_num_vagon 		SELECT f.num_vagon,		comment6 as vagon_comment			FROM 		(SELECT t.*,			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908727 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment1, 			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908728 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment2, 			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908729 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment3, 			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908730 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment4, 			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908731 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment5,			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908732 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment6,  			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908733 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment7,     			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908734 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment8,    			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908735 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment9,                               			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 908736 ) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment10,  			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 2279355) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment11,      			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 4766052) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment12,      			  (SELECT top 1 c.vagon_comment FROM vagon_comment c WITH (NOLOCK) WHERE (c.vagon_id = t.vagon_id) AND (c.vagon_comment_type_id = 1385291) AND (date_query BETWEEN c.date_begin AND ISNULL(c.date_end + 0.999 , date_query)))  as comment13  			FROM FACT_TRACK_STAT t WITH (NOLOCK)		JOIN view_vagon_owner vo WITH (NOLOCK) ON vo.num_vagon = t.num_vagon AND  (vo.users_group_id = 1139124) AND (GetDate() BETWEEN vo.date_begin AND ISNULL(vo.date_end, GetDate() + 1))		) f			WHERE f.users_group_id = 1139124 AND node_end_name='Новолесная' OR comment1='Новолесная' OR comment1='?Новолесная' OR node_begin_name='Новолесная' OR node_end_name='Безымянная' OR comment1='Безымянная' OR comment1='?Безымянная' OR node_begin_name='Безымянная'--?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;Lis1;                  0;
1;26.04.2022 19:01:29.014;90;"<?query --BACKUP DATABASE [Lis1] TO  DISK = N'\\10.10.101.33\backup-lis\Lis1\Lis1_backup_2022_04_26_190001_3779401.bak' WITH  DIFFERENTIAL , NOFORMAT, NOINIT,  NAME = N'Lis1_backup_2022_04_26_190001_3779401', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10--?>";sa;(42119ms)ASYNC_IO_COMPLETION;ULSRV-LIS;Lis1;                  0;
2;26.04.2022 19:01:29.023;all_base_bkp.incremental;Running;26.04.2022 19:00:00;88;
2;26.04.2022 19:01:29.023;sp_fact_track_mailing;Running;26.04.2022 19:00:00;88;
1;26.04.2022 19:01:52.722;90;"<?query --BACKUP DATABASE [Lis1] TO  DISK = N'\\10.10.101.33\backup-lis\Lis1\Lis1_backup_2022_04_26_190001_3779401.bak' WITH  DIFFERENTIAL , NOFORMAT, NOINIT,  NAME = N'Lis1_backup_2022_04_26_190001_3779401', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10--?>";sa;(65832ms)ASYNC_IO_COMPLETION;ULSRV-LIS;Lis1;                  0;
2;26.04.2022 19:01:52.731;all_base_bkp.incremental;Running;26.04.2022 19:00:00;112;
1;26.04.2022 19:05:25.801;90;"<?query --BACKUP DATABASE [Lis1] TO  DISK = N'\\10.10.101.33\backup-lis\Lis1\Lis1_backup_2022_04_26_190001_3779401.bak' WITH  DIFFERENTIAL , NOFORMAT, NOINIT,  NAME = N'Lis1_backup_2022_04_26_190001_3779401', SKIP, REWIND, NOUNLOAD, COMPRESSION,  STATS = 10--?>";sa;(278891ms)ASYNC_IO_COMPLETION;ULSRV-LIS;Lis1;                  0;
2;26.04.2022 19:05:25.811;all_base_bkp.incremental;Running;26.04.2022 19:00:00;325;
1;26.04.2022 19:08:05.731;90;"<?query --RESTORE VERIFYONLY FROM  DISK = N'\\10.10.101.33\backup-lis\Lis1\Lis1_backup_2022_04_26_190001_3779401.bak' WITH  FILE = @backupSetId,  NOUNLOAD,  NOREWIND--?>";sa;(150774ms)BACKUPTHREAD;ULSRV-LIS;master;                  0;
2;26.04.2022 19:08:05.740;all_base_bkp.incremental;Running;26.04.2022 19:00:00;485;
1;26.04.2022 19:08:14.960;90;"<?query --RESTORE VERIFYONLY FROM  DISK = N'\\10.10.101.33\backup-lis\Lis1\Lis1_backup_2022_04_26_190001_3779401.bak' WITH  FILE = @backupSetId,  NOUNLOAD,  NOREWIND--?>";sa;(159988ms)BACKUPTHREAD;ULSRV-LIS;master;                  0;
2;26.04.2022 19:08:14.969;all_base_bkp.incremental;Running;26.04.2022 19:00:00;494;
1;26.04.2022 19:26:48.126;92;"<?query --INSERT INTO invDue (invoice_id, dueTypeID, dueType, carNumber, contNumber, dueDistanceName, dueCalcDistanceName, distMinWay, dueWeightCalc,						dueAmount, dueCurrencyId, dueCurrency, dueScheme, dueTarifRate, dueSumInfr, dueSchemeNumWag, dueTarifRateWag, dueSumWag,						dueTarifCoef, dueTaxSum, dueTaxAble, dueTaxVal,dueFreightTarifClass, dueTarifDiscount, dueTarifPercent, dueTarifCode, dueCurrencyRate, dueAmountInfr, dueAmountLok,						dueCalcDistStCode, dueCalcDistStName)	SELECT	@invoice_id, 			ref.value('(dueTypeID/@value)[1]','int')                    dueTypeID,			ref.value('(dueType/@value)[1]','varchar(255)')             dueType,			ref.value('(carNumber/@value)[1]','varchar(8)')             carNumber,			ref.value('(contNumber/@value)[1]','varchar(20)')           contNumber,			ref.value('(dueDistanceName/@value)[1]','varchar(40)')      dueDistanceName,			ref.value('(dueCalcDistanceName/@value)[1]','varchar(80)')  dueCalcDistanceName,			ref.value('(distMinWay/@value)[1]','money')                 distMinWay,			ref.value('(dueWeightCalc/@value)[1]','money')              dueWeightCalc,			ref.value('(dueAmount/@value)[1]','money')                  dueAmount,			ref.value('(dueCurrencyId/@value)[1]','int')                dueCurrencyId,			ref.value('(dueCurrency/@value)[1]','varchar(132)')         dueCurrency,			ref.value('(dueScheme/@value)[1]','money')                  dueScheme,			ref.value('(dueTarifRate/@value)[1]','money')               dueTarifRate,			ref.value('(dueSumInfr/@value)[1]','money')                 dueSumInfr,			ref.value('(dueSchemeNumWag/@value)[1]','money')            dueSchemeNumWag,			ref.value('(dueTarifRateWag/@value)[1]','money')            dueTarifRateWag,			ref.value('(dueSumWag/@value)[1]','money')                  dueSumWag,			ref.value('(dueTarifCoef/@value)[1]','money')               dueTarifCoef,			ref.value('(dueTaxSum/@value)[1]','money')                  dueTaxSum,			ref.value('(dueTaxAble/@value)[1]','money')                 dueTaxAble,			ref.value('(dueTaxVal/@value)[1]','money')                  dueTaxVal,			ref.value('(dueFreightTarifClass/@value)[1]','varchar(20)') dueFreightTarifClass,			ref.value('(dueTarifDiscount/@value)[1]','money')           dueTarifDiscount,			ref.value('(dueTarifPercent/@value)[1]','money')            dueTarifPercent,			ref.value('(dueTarifCode/@value)[1]','money')               dueTarifCode,			ref.value('(dueCurrencyRate/@value)[1]','money')            dueCurrencyRate,			ref.value('(dueAmountInfr/@value)[1]','money')              dueAmountInfr,			ref.value('(dueAmountLok/@value)[1]','money')               dueAmountLok,			ref.value('(dueCalcDistStCode/@value)[1]','varchar(40)')	dueCalcDistStCode,			ref.value('(dueCalcDistStName/@value)[1]','varchar(200)')	dueCalcDistStName	FROM	@xml_info.nodes('/getInvoiceReply/invDue') as node(ref)	--?>";etran_ulg;;DESKTOP-TRN97HV;Lis_Etran;                  5;
1;26.04.2022 19:54:30.389;76;"<?query --SELECT				m.milage_passed, 				m.milage_rest,              wp.vagon_id, 			  fact_track_id, t.num_vagon, rod_vagon, type_vagon, date_otpr, state_self, fact_weight, poluchgr, special_marks, comment, date_operation, time_operation, index_train, num_train, kargoETSNG_name, kargoETSNG_cod, node_end_name, t.node_end_cod, node_begin_name, t.node_begin_cod, road_begin_name, road_begin_cod, road_end_name, road_end_cod, fact_track_color, file_load_name, file_load_date, type_sps_id, type_sps_name, FIO_users, global_color, cod_operation_train_name, cod_operation_train_cod, cod_operation_vagon_cod, cod_operation_vagon_name, cod_operation_train_id, cod_operation_vagon_id, cod_operation_vagon_name_full, cod_operation_train_name_full, cod_operation_cod, users_id, file_load_date_dt, type_park_vagon_name, date_query, type_park_vagon, time_otpr, road_name_end, doc_number, node_begin_road_name, node_end_road_name, vagon_owner_firm_id, road_operation_name, road_operation_cod, t.node_operation_cod, node_operation_name, t.users_group_id, vagon_owner_name, node_begin_road_cod, node_end_road_cod, t.fact_track_trip_id, set_archive, grpol_okpo, grotpr_okpo, RW_grpol, RW_grotpr, DateLoading, RW_Rash, idReis, DatePrib, DateVygr, instruction_id, instruction_cod, instruction_date, etran_ecp_id, etran_comment, nPut, nPark, date_arrival, state_begin_cod, state_begin_name, state_end_cod, state_end_name, IsEmpty, nvp,			  grotpr_name, grpol_name,-- t.*,              CASE WHEN t.node_begin_cod = t.node_operation_cod  THEN 0 ELSE dist1.[distance] END as distance1,               CASE WHEN t.node_operation_cod = t.node_end_cod    THEN 0 ELSE dist2.[distance] END as distance2,               dist2.days_way,              wp.note, wp.comments, wp.date_build, wp.firm_customer_name, wp.type_park_name, wp.type_park_cod, wp.type_park_id,              wp.model_name, wp.volume, wp.uchet_name, wp.copper_calibration, wp.capacity, wp.rod_vagon_name, wp.arenda_firm_name,              cs0.count_stay0,			  cs1.count_stay1,			  cs2.count_stay2,              te.num_document_etr, te.claim_num_etr, te.node_begin_name_etr, te.node_end_name_etr, te.etran_oper_date, te.etran_oper_result, te.payer_cod,              p.date_registration, p.quality_mark_name, p.exception_reason_name, p.date_last_place, p.next_date_repair,			  t.OwnerOkpo, t.OwnerOkpoName, t.ArendOkpo, t.ArendOkpoName, t.OperName, t.OperDateEnd 			INTO #fact_track_stat_temp			FROM #disl t  				LEFT OUTER JOIN #work_park wp  ON wp.num_vagon = t.num_vagon AND wp.users_group_id = t.users_group_id                LEFT OUTER JOIN #temp_oper te  ON te.num_vagon = t.num_vagon AND te.users_group_id = t.users_group_id                LEFT OUTER JOIN view_inf_obj_distance dist1  ON dist1.[node_begin_cod] = t.node_begin_cod     AND dist1.[node_end_cod] = t.node_operation_cod                 LEFT OUTER JOIN view_inf_obj_distance dist2  ON dist2.[node_begin_cod] = t.node_operation_cod AND dist2.[node_end_cod] = t.node_end_cod                  LEFT OUTER JOIN #ParamStat p ON t.num_vagon = p.num_vagon AND t.users_group_id = p.users_group_id				LEFT JOIN #milage m ON t.num_vagon = m.num_vagon				LEFT JOIN #count_stay0 cs0 ON cs0.users_group_id = t.users_group_id AND cs0.num_vagon = t.num_vagon	AND cs0.fact_track_trip_id = t.fact_track_trip_id				LEFT JOIN #count_stay1 cs1 ON cs1.users_group_id = t.users_group_id AND cs1.num_vagon = t.num_vagon 				LEFT JOIN #count_stay2 cs2 ON cs2.users_group_id = t.users_group_id	AND cs2.num_vagon = t.num_vagon	AND cs2.fact_track_trip_id = t.fact_track_trip_id AND cs2.node_operation_cod = t.node_operation_cod				--SELECT [fact_track_id]  --         ,[num_vagon]             --         ,[type_park_name]  --         ,[type_park_cod]  --         ,[type_park_id]           		--   FROM #fact_track_stat_temp		--   WHERE num_vagon = 58982430--print '15'		--?>";ULSRV-LIS\adm-sql;;ULSRV-LIS;tempdb;                  3;
2;26.04.2022 19:54:30.398;LoadFactTrackStat;Running;26.04.2022 19:50:00;269;
1;26.04.2022 19:57:24.877;62;"<?query --SELECT * FROM 			(				SELECT	TOP 100 files_name, cast(substring(files_date,1,8) + ' ' + substring(files_date,9,2) + ':' + substring(files_date,11,2) + ':00' as datetime) files_date				FROM	#files_name_xml				WHERE	files_name not in (SELECT files_name FROM view_fact_track_files WHERE users_group_id = @users_group_id)						AND IsDate(substring(files_date,1,8) + ' ' + substring(files_date,9,2) + ':' + substring(files_date,11,2) + ':00') = 1			) x1			WHERE files_date > '20180608'			ORDER BY 1 DESC			--?>";sa;;PC-ETRAN6;Lis1;                  1;
